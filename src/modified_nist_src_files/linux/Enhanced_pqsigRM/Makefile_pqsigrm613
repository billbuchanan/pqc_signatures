#modified-flag
CC = gcc

LDFLAGS =  -L/usr/local/lib
CFLAGS = -I/usr/local/include -Isrc -Wunused-variable -Wunused-function
LIBFLAGS = -lcrypto -lssl -lm
CFILES := $(shell find src -name '*.c' | sed -e 's/\.c/\.o/')

OBJS = ${CFILES}

ifeq ($(DEBUG), 1)
    DBG_FLAGS = -g -O0 -DDEBUG
else
    DBG_FLAGS = -O2 -DNDEBUG -Wunused-variable -Wunused-function
endif

.PHONY: all clean

all: sign runtime pqcsign

%.o : %.c
	$(CC) $(CFLAGS) $(DBG_FLAGS) -o $@ -c $<  # Ensure this line begins with a tab, not spaces
	
sign: ${OBJS} ./PQCgenKAT_sign.c
	$(CC) $(LDFLAGS) $(CFLAGS) $(DBG_FLAGS) -o $@ $^ $(LIBFLAGS)

runtime: ${OBJS} ./runtime.c
	$(CC) $(LDFLAGS) $(CFLAGS) $(DBG_FLAGS) -o $@ $^ $(LIBFLAGS)

test: ${OBJS} ./test.c
	$(CC) $(LDFLAGS) $(CFLAGS) $(DBG_FLAGS) -o $@ $^ $(LIBFLAGS)

pqcsign: ${OBJS} pqcsign.c
	$(CC) $(LDFLAGS) $(CFLAGS) $(DBG_FLAGS) -o $@ $^ $(LIBFLAGS)

matrix.o : matrix.h
rng.o : rng.h
api.o : api.h

clean:
	cd src; rm -f *.o; cd ..
	rm -f *.o
	rm -f sign runtime test pqcsign

