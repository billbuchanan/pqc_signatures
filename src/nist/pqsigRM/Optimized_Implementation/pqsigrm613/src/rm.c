#include "rm.h"

const uint16_t rm_dim[7][13] ={
	{1,1,1,1,1,1,1,1,1,1,1,1,1}, 
	{0,2,3,4,5,6,7,8,9,10,11,12,13}, 
	{0,0,4,7,11,16,22,29,37,46,56,67,79}, 
	{0,0,0,8,15,26,42,64,93,130,176,232,299}, 
	{0,0,0,0,16,31,57,99,163,256,386,562,794}, 
	{0,0,0,0,0,32,63,120,219,382,638,1024,1586}, 
	{0,0,0,0,0,0,64,127,247,466,848,1486,2510}
};

const uint64_t genmat_rm6[] = {
0xffffffffffffffff, 0x5555555555555555, 0x3333333333333333, 0x0f0f0f0f0f0f0f0f, 
0x00ff00ff00ff00ff, 0x0000ffff0000ffff, 0x00000000ffffffff, 0x1111111111111111, 
0x0505050505050505, 0x0055005500550055, 0x0000555500005555, 0x0000000055555555, 
0x0303030303030303, 0x0033003300330033, 0x0000333300003333, 0x0000000033333333, 
0x000f000f000f000f, 0x00000f0f00000f0f, 0x000000000f0f0f0f, 0x000000ff000000ff, 
0x0000000000ff00ff, 0x000000000000ffff, 0x0101010101010101, 0x0011001100110011, 
0x0000111100001111, 0x0000000011111111, 0x0005000500050005, 0x0000050500000505, 
0x0000000005050505, 0x0000005500000055, 0x0000000000550055, 0x0000000000005555, 
0x0003000300030003, 0x0000030300000303, 0x0000000003030303, 0x0000003300000033, 
0x0000000000330033, 0x0000000000003333, 0x0000000f0000000f, 0x00000000000f000f, 
0x0000000000000f0f, 0x00000000000000ff, 0x0001000100010001, 0x0000010100000101, 
0x0000000001010101, 0x0000001100000011, 0x0000000000110011, 0x0000000000001111, 
0x0000000500000005, 0x0000000000050005, 0x0000000000000505, 0x0000000000000055, 
0x0000000300000003, 0x0000000000030003, 0x0000000000000303, 0x0000000000000033, 
0x000000000000000f, 0x0000000100000001, 0x0000000000010001, 0x0000000000000101, 
0x0000000000000011, 0x0000000000000005, 0x0000000000000003, 0x0000000000000001,
};

void rm_gen(matrix* gen, uint32_t r, uint32_t m, uint32_t row_f, uint32_t row_r, 
	uint32_t col_f, uint32_t col_r) {
	if (m < 6 || r > m) {
		fprintf(stderr, "Recursion fails! r: %d, m: %d\n", r, m);
		exit(EXIT_FAILURE);
	}

	if (r == 0){
		for	(uint32_t i = 0; i < (1<<m)/64; i++){
			gen->elem[row_f][col_f/64 + i] = 0xffffffffffffffffULL;
		}
		return;
	}

	if (m == 6) {
		for (uint32_t i = 0; i < rm_dim[r][m]; i++) {
			gen->elem[row_f + i][col_f/64] = genmat_rm6[i];
		}
		return;
	} 
	
	uint32_t col_m = (col_f+col_r)/2;
	rm_gen(gen, r,   m-1, 	row_f, row_f + rm_dim[r][m-1], col_f, 	col_m);
	rm_gen(gen, r,   m-1, 	row_f, row_f + rm_dim[r][m-1], col_m, 	col_r);
	rm_gen(gen, r-1, m-1,  	row_f + rm_dim[r][m-1], row_r, col_m, 	col_r);

	return;
}
